<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Datagres - Database Explorer</title>
  </head>
  <body>
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: system-ui, -apple-system, sans-serif;">
      <h2 style="margin-bottom: 20px; color: #333;">Datagres - Database Explorer</h2>
      <div style="display: flex; gap: 8px; align-items: center;">
        <input 
          id="connection-input"
          type="text" 
          placeholder="Paste connection string here"
          style="width: 400px; padding: 12px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;"
        />
        <button 
          id="connect-button"
          style="padding: 12px 20px; font-size: 14px; background-color: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;"
        >
          Connect
        </button>
      </div>
      <div 
        id="connection-status"
        data-testid="connection-status" 
        style="margin-top: 16px; padding: 12px; border-radius: 4px; min-height: 20px; font-size: 14px; text-align: center;"
      >
      </div>
    </div>

    <script>
      const { ipcRenderer } = require('electron');
      
      const connectionInput = document.getElementById('connection-input');
      const connectButton = document.getElementById('connect-button');
      const statusDiv = document.getElementById('connection-status');

      function showStatus(message, type = 'info') {
        statusDiv.textContent = message;
        statusDiv.style.backgroundColor = type === 'error' ? '#fee' : type === 'success' ? '#efe' : '#f0f8ff';
        statusDiv.style.color = type === 'error' ? '#c33' : type === 'success' ? '#060' : '#333';
        statusDiv.style.border = type === 'error' ? '1px solid #fcc' : type === 'success' ? '1px solid #cfc' : '1px solid #ddd';
      }

      function validateConnectionString(connectionString) {
        // PostgreSQL connection string validation (password optional)
        const pgRegex = /^postgresql:\/\/([^:@]+(:([^@]*))?@)?[^:\/]+:\d+\/[\w-]+$/;
        return pgRegex.test(connectionString);
      }

      connectButton.addEventListener('click', async () => {
        const connectionString = connectionInput.value.trim();
        
        if (!connectionString) {
          showStatus('Please enter a connection string', 'error');
          return;
        }

        if (!validateConnectionString(connectionString)) {
          showStatus('Invalid connection string format', 'error');
          return;
        }

        // Show connecting state
        showStatus('Connecting...', 'info');
        connectButton.disabled = true;
        connectButton.textContent = 'Connecting...';

        try {
          // Send connection request to main process
          const result = await ipcRenderer.invoke('connect-database', connectionString);
          
          if (result.success) {
            showStatus(`Connected to ${result.database}`, 'success');
            connectButton.textContent = 'Connected';
          } else {
            showStatus(`Connection failed: ${result.error}`, 'error');
            connectButton.disabled = false;
            connectButton.textContent = 'Connect';
          }
        } catch (error) {
          showStatus(`Connection error: ${error.message}`, 'error');
          connectButton.disabled = false;
          connectButton.textContent = 'Connect';
        }
      });
    </script>
  </body>
</html>